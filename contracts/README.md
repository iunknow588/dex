# æ™ºè¿é€šé—ªç”µè´·æ¸…ç®—åˆçº¦

åŸºäºInjectiveåŒºå—é“¾çš„é—ªç”µè´·æ¸…ç®—æ™ºèƒ½åˆçº¦ï¼Œå®ç°æ— æœ¬é‡‘æ¸…ç®—å¥—åˆ©åŠŸèƒ½ã€‚

## ğŸ“‹ åŠŸèƒ½ç‰¹æ€§

### ğŸš€ æ ¸å¿ƒåŠŸèƒ½
- **é—ªç”µè´·**: æ”¯æŒå¤šèµ„äº§é—ªç”µè´·ï¼Œæ— éœ€æŠµæŠ¼
- **æ¸…ç®—å¥—åˆ©**: è‡ªåŠ¨æ£€æµ‹å¹¶æ‰§è¡Œæ¸…ç®—æœºä¼š
- **é£é™©æ§åˆ¶**: å¤šå±‚æ¬¡å®‰å…¨æ£€æŸ¥å’Œæ»‘ç‚¹ä¿æŠ¤
- **Injectiveé›†æˆ**: ä¸Injective Exchangeæ¨¡å—æ·±åº¦é›†æˆ

### ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§
- **é‡å…¥ä¿æŠ¤**: ä½¿ç”¨OpenZeppelinçš„ReentrancyGuard
- **æš‚åœæœºåˆ¶**: æ”¯æŒç´§æ€¥æš‚åœåŠŸèƒ½
- **è®¿é—®æ§åˆ¶**: ä¸¥æ ¼çš„æƒé™ç®¡ç†ç³»ç»Ÿ
- **å‚æ•°éªŒè¯**: å®Œæ•´çš„è¾“å…¥éªŒè¯å’Œè¾¹ç•Œæ£€æŸ¥

## ğŸ—ï¸ åˆçº¦æ¶æ„

```
contracts/
â”œâ”€â”€ interfaces/           # åˆçº¦æ¥å£å®šä¹‰
â”‚   â”œâ”€â”€ IFlashLoan.sol    # é—ªç”µè´·æ¥å£
â”‚   â””â”€â”€ ILiquidation.sol  # æ¸…ç®—æ¥å£
â”œâ”€â”€ libraries/            # å·¥å…·åº“
â”‚   â””â”€â”€ RiskControl.sol   # é£é™©æ§åˆ¶åº“
â”œâ”€â”€ src/                  # ä¸»è¦åˆçº¦
â”‚   â””â”€â”€ LuckeeFlashLiquidation.sol  # ä¸»åˆçº¦
â”œâ”€â”€ scripts/              # éƒ¨ç½²è„šæœ¬
â”‚   â””â”€â”€ deploy.ts         # éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ test/                 # æµ‹è¯•æ–‡ä»¶
â”‚   â”œâ”€â”€ LuckeeFlashLiquidation.test.ts
â”‚   â””â”€â”€ TestERC20.sol     # æµ‹è¯•ä»£å¸
â””â”€â”€ README.md            # æ–‡æ¡£
```

## ğŸ”§ å®‰è£…å’Œè®¾ç½®

### ç¯å¢ƒè¦æ±‚
- Node.js 18+
- npm æˆ– yarn
- Hardhat

### å®‰è£…ä¾èµ–
```bash
cd contracts
npm install
```

### ç¼–è¯‘åˆçº¦
```bash
npm run compile
```

### è¿è¡Œæµ‹è¯•
```bash
npm run test
```

### ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡
```bash
npm run test:coverage
```

## ğŸš€ éƒ¨ç½²

### æœ¬åœ°éƒ¨ç½²
```bash
npm run deploy
```

### Injectiveæµ‹è¯•ç½‘éƒ¨ç½²
```bash
npm run deploy:injective
```

### è‡ªå®šä¹‰ç½‘ç»œéƒ¨ç½²
```bash
npx hardhat run scripts/deploy.ts --network <network-name>
```

## ğŸ“‹ åˆçº¦æ¥å£

### é—ªç”µè´·åŠŸèƒ½

#### flashLoan
```solidity
function flashLoan(
    address asset,
    uint256 amount,
    bytes calldata params
) external
```
æ‰§è¡Œé—ªç”µè´·æ“ä½œï¼Œæ”¯æŒåœ¨åŒä¸€äº¤æ˜“ä¸­å€Ÿè´·å’Œè¿˜æ¬¾ã€‚

**å‚æ•°:**
- `asset`: å€Ÿè´·èµ„äº§åœ°å€ (address(0) è¡¨ç¤ºETH)
- `amount`: å€Ÿè´·é‡‘é¢
- `params`: åŒ…å«æ¸…ç®—å‚æ•°çš„ç¼–ç æ•°æ®

#### executeOperation
```solidity
function executeOperation(
    address asset,
    uint256 amount,
    uint256 premium,
    address initiator,
    bytes calldata params
) external returns (bool)
```
é—ªç”µè´·å›è°ƒå‡½æ•°ï¼Œæ‰§è¡Œæ¸…ç®—é€»è¾‘ã€‚

### æ¸…ç®—åŠŸèƒ½

#### executeLiquidation
```solidity
function executeLiquidation(
    LiquidationParams calldata params
) external returns (bool success, uint256 reward, uint256 gasCost)
```
æ‰§è¡Œæ¸…ç®—æ“ä½œã€‚

**å‚æ•°:**
- `params`: æ¸…ç®—å‚æ•°ç»“æ„ä½“

**è¿”å›:**
- `success`: æ˜¯å¦æ‰§è¡ŒæˆåŠŸ
- `reward`: æ¸…ç®—å¥–åŠ±é‡‘é¢
- `gasCost`: é¢„ä¼°Gasè´¹ç”¨

#### validateLiquidationOpportunity
```solidity
function validateLiquidationOpportunity(
    bytes32 marketId,
    address subaccountId
) external view returns (bool isValid, uint256 healthFactor, uint256 maxLiquidationAmount)
```
éªŒè¯æ¸…ç®—æœºä¼šçš„æœ‰æ•ˆæ€§ã€‚

## ğŸ” å®‰å…¨æœºåˆ¶

### é£é™©æ§åˆ¶
- **æ»‘ç‚¹ä¿æŠ¤**: æœ€å¤§5%æ»‘ç‚¹å®¹å¿åº¦
- **æˆªæ­¢æ—¶é—´**: é˜²æ­¢äº¤æ˜“è¿‡æœŸæ‰§è¡Œ
- **æµåŠ¨æ€§æ£€æŸ¥**: ç¡®ä¿æœ‰è¶³å¤Ÿçš„å¯ç”¨èµ„é‡‘
- **å¥åº·å› å­éªŒè¯**: åªæ¸…ç®—å¥åº·å› å­<1çš„ä»“ä½

### è®¿é—®æ§åˆ¶
- **æ‰€æœ‰è€…æƒé™**: åªæœ‰åˆçº¦æ‰€æœ‰è€…å¯ä»¥æ·»åŠ èµ„äº§ã€è®¾ç½®å‚æ•°
- **æ¸…ç®—è€…æˆæƒ**: åªæœ‰æˆæƒçš„æ¸…ç®—è€…å¯ä»¥æ‰§è¡Œæ¸…ç®—
- **æš‚åœæœºåˆ¶**: ç´§æ€¥æƒ…å†µä¸‹å¯ä»¥æš‚åœæ‰€æœ‰æ“ä½œ

### è´¹ç”¨æœºåˆ¶
- **é—ªç”µè´·è´¹ç”¨**: 0.09% (9åŸºç‚¹)
- **æ¸…ç®—å¥–åŠ±**: 5-10% (å¯é…ç½®)
- **Gasè´¹ç”¨**: åŠ¨æ€ä¼°ç®—

## ğŸ§ª æµ‹è¯•

### è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
```bash
npm run test
```

### è¿è¡Œç‰¹å®šæµ‹è¯•
```bash
npx hardhat test test/LuckeeFlashLiquidation.test.ts
```

### Gasä½¿ç”¨åˆ†æ
```bash
npm run test:gas
```

## ğŸ“Š å‚æ•°é…ç½®

### é»˜è®¤å‚æ•°
```solidity
FLASHLOAN_PREMIUM = 9;        // 0.09% é—ªç”µè´·è´¹ç”¨
LIQUIDATION_THRESHOLD = 10000; // 100% å¥åº·å› å­é˜ˆå€¼
MAX_SLIPPAGE = 500;           // 5% æœ€å¤§æ»‘ç‚¹
GRACE_PERIOD = 300;           // 5åˆ†é’Ÿå®½é™æœŸ
```

### å¯é…ç½®å‚æ•°
- æ”¯æŒçš„èµ„äº§åˆ—è¡¨
- å¸‚åœºæ¸…ç®—å¥–åŠ±æ¯”ä¾‹
- æˆæƒæ¸…ç®—è€…åˆ—è¡¨
- é£é™©å‚æ•°é˜ˆå€¼

## ğŸ”— ä¸å‰ç«¯é›†æˆ

### åˆçº¦è°ƒç”¨ç¤ºä¾‹
```typescript
// æ‰§è¡Œé—ªç”µè´·æ¸…ç®—
const flashLoanParams = {
  asset: '0x...',           // èµ„äº§åœ°å€
  amount: ethers.parseEther('100'), // å€Ÿè´·é‡‘é¢
  liquidationParams: {      // æ¸…ç®—å‚æ•°
    marketId: marketId,
    subaccountId: subaccountId,
    liquidationAmount: amount,
    // ... å…¶ä»–å‚æ•°
  }
};

// ç¼–ç å‚æ•°
const params = ethers.AbiCoder.defaultAbiCoder().encode([...], [flashLoanParams]);

// è°ƒç”¨åˆçº¦
await flashLiquidation.flashLoan(asset, amount, params);
```

## ğŸ“ˆ ç›‘æ§å’Œç»´æŠ¤

### äº‹ä»¶ç›‘æ§
åˆçº¦å‘å‡ºä»¥ä¸‹å…³é”®äº‹ä»¶ï¼š
- `FlashLoanExecuted`: é—ªç”µè´·æ‰§è¡Œå®Œæˆ
- `LiquidationExecuted`: æ¸…ç®—æ‰§è¡Œå®Œæˆ
- `LiquidationFailed`: æ¸…ç®—æ‰§è¡Œå¤±è´¥
- `AssetAdded/Removed`: èµ„äº§æ·»åŠ /ç§»é™¤

### ç´§æ€¥æ“ä½œ
- **æš‚åœ**: `pause()` - æš‚åœæ‰€æœ‰æ“ä½œ
- **æ¢å¤**: `unpause()` - æ¢å¤æ­£å¸¸æ“ä½œ
- **èµ„é‡‘æå–**: `withdraw()` - æå–åˆçº¦èµ„é‡‘

## ğŸš¨ é£é™©æç¤º

1. **æ™ºèƒ½åˆçº¦é£é™©**: å°½ç®¡ç»è¿‡å®¡è®¡ï¼Œä½†ä»å­˜åœ¨æœªçŸ¥æ¼æ´é£é™©
2. **ç½‘ç»œé£é™©**: Injectiveç½‘ç»œå¯èƒ½å‡ºç°æ‹¥å µæˆ–å¼‚å¸¸
3. **é¢„è¨€æœºé£é™©**: ä»·æ ¼æ•°æ®ä¾èµ–å¤–éƒ¨é¢„è¨€æœº
4. **æ¸…ç®—é£é™©**: æ¸…ç®—æ—¶æœºå’Œå¥–åŠ±å¯èƒ½å› å¸‚åœºæ³¢åŠ¨è€Œå˜åŒ–
5. **Gasè´¹ç”¨**: é«˜å¹¶å‘æ—¶Gasè´¹ç”¨å¯èƒ½å¤§å¹…å¢åŠ 

## ğŸ”§ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°åŠŸèƒ½
1. åœ¨æ¥å£ä¸­å®šä¹‰æ–°æ–¹æ³•
2. åœ¨ä¸»åˆçº¦ä¸­å®ç°é€»è¾‘
3. æ·»åŠ ç›¸åº”çš„æµ‹è¯•ç”¨ä¾‹
4. æ›´æ–°æ–‡æ¡£

### ä¿®æ”¹å‚æ•°
1. è¯„ä¼°å½±å“èŒƒå›´
2. æ›´æ–°ç›¸å…³éªŒè¯é€»è¾‘
3. è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
4. éƒ¨ç½²å‰è¿›è¡Œæ¨¡æ‹Ÿæµ‹è¯•

### å‡çº§åˆçº¦
è€ƒè™‘ä½¿ç”¨ä»£ç†æ¨¡å¼æ”¯æŒåˆçº¦å‡çº§ï¼Œä¿æŠ¤ç”¨æˆ·èµ„é‡‘å®‰å…¨ã€‚

---

**æ³¨æ„**: è¿™æ˜¯ä¸€ä¸ªå¤æ‚çš„DeFiåˆçº¦ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨å‰è¯·åŠ¡å¿…è¿›è¡Œä¸“ä¸šå®‰å…¨å®¡è®¡ã€‚
